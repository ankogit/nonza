---
description: Vue — оптимизация перерисовок и v-memo
globs: frontend/**/*.vue
alwaysApply: false
---

# Vue: оптимизация перерисовок

## Перед оптимизацией

1. **Сначала замерь** — добавь логи (`onUpdated`, `onMounted`) в компоненты, которые подозреваешь. Убедись, что перерисовывается именно то, что думаешь, и сколько раз.
2. **Один экземпляр или много** — если в логах несколько обновлений, проверь по `uid`/ключу: один и тот же компонент обновляется N раз или N разных экземпляров по одному разу.

## v-memo: разделяй по зависимостям

- **Один блок v-memo — один «срез» данных.** Не смешивай в одних зависимостях то, что меняется в разное время (имя + реплика + лидер + рука). Иначе при любом из этих изменений перерисуется весь блок.
- **Разнеси блоки по смыслу:** например, блок «имя + реплика» с deps `[participantName, replicaText]`, блок «лидер» с deps `[isLeader]`, блок «рука» с deps `[hasRaisedHand]`. Тогда смена только isLeader не трогает имя и реплику.
- **Стабильные ref для v-memo:** если блок должен перерисовываться только при изменении полей A и B, веди отдельный ref (или пару ref), обновляемый только при изменении A/B. Остальные пропсы (C, D) — в других ref или прямо в шаблоне, чтобы их смена не трогала блок с A/B.
- **Computed для массива deps:** для v-memo используй computed, возвращающий массив зависимостей, чтобы при тех же значениях была одна и та же ссылка и Vue мог стабильно кэшировать поддерево.

## Ключи в v-for

- **Ключ = идентичность элемента списка**, а не его изменяемое состояние. Не включай в ключ то, что часто меняется (например, `trackPublications?.size`, mute/unmute), иначе компоненты будут пересоздаваться без необходимости.
- Используй стабильный идентификатор: id, identity, составной ключ из «роль + id» и т.п.

## Именование

- Не называй переменные и классы по раскладке («left», «right») там, где имеется в виду смысл блока (имя участника, реплика, бейджи). Используй семантичные имена: `nameReplica`, `leaderHand`, классы типа `player-menu__identity`, `player-menu__badges`. Классы вёрстки (`.left`, `.right`) оставляй только для позиционирования в CSS.
